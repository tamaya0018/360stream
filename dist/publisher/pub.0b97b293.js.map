{"mappings":"oeAAA,IAAAA,EAAAC,EAAA,SAEA,IAAIC,EAAIC,EACR,MAAMC,EAAaC,SAASC,eAAe,eACrCC,EAAaF,SAASC,eAAe,eACrCE,EAAaH,SAASC,eAAe,eACrCG,EAAaJ,SAASC,eAAe,eACrCI,EAAgBL,SAASC,eAAe,kBAoD9CE,EAAWG,QAAU,KACnBC,UAAUC,aAAaC,mBACpBC,MAAKC,IACiBA,EAAQC,QAAOC,GAA0B,eAAhBA,EAAOC,OACxCC,SAAQF,IACnBG,QAAQC,IAAIJ,EAAOC,KAAO,KAAOD,EAAOK,MAAQ,SAAWL,EAAOM,UAClE,MAAMC,EAASpB,SAASqB,cAAc,UACtCD,EAAOE,MAAQT,EAAOM,SACtBC,EAAOG,KAAOV,EAAOK,MACrBhB,EAAWsB,YAAYJ,EAAA,GACzB,IAEDK,OAAMC,IACLV,QAAQC,IAAIS,EAAIC,KAAO,KAAOD,EAAIE,QAAO,GAC3C,EAKJ1B,EAAW2B,SAAWC,UACpBd,QAAQC,IAAIf,EAAWoB,OACvBxB,QAAcH,EAAAoC,oBAAoBC,wBAChC,CAAEb,SAAUjB,EAAWoB,QAEzBxB,EAAMmC,OAAOlC,SACPA,EAAWmC,MAAI,EAIvB9B,EAAWE,QAAUwB,UACnB,MAAMK,EAAgBnC,SAASC,eAAe,aACxCmC,EAAOpC,SAASC,eAAe,SACrC,GAA4B,KAAxBkC,EAAcb,MAAc,OAEhC,MAAMe,QAAgB1C,EAAA2C,cAAcC,OAjFtB,IAAI,EAAA5C,EAAA6C,iBAAgB,CAChCC,KAAK,EAAA9C,EAAA+C,UACLC,KAAK,EAAAhD,EAAAiD,YACLC,KAAK,EAAAlD,EAAAiD,YAAa,MAClBE,MAAO,CACLC,IAAK,CACHC,GAAI,uCACJC,MAAM,EACNC,QAAS,CAAC,QACVC,SAAU,CACR,CACEH,GAAI,IACJrB,KAAM,IACNuB,QAAS,CAAC,SACVE,QAAS,CACP,CACEJ,GAAI,IACJrB,KAAM,IACNuB,QAAS,CAAC,SACVG,YAAa,CACXH,QAAS,CAAC,UAEZI,aAAc,CACZJ,QAAS,CAAC,YAIhBK,QAAS,CACP,CACEL,QAAS,CAAC,SACVM,YAAa,CACX,CACEN,QAAS,CAAC,mBASzBO,OAAO,iDAyCJC,QAAa/D,EAAAgE,WAAWC,aAAavB,EAAS,CAClDwB,KAAM,MACNlC,KAAMQ,EAAcb,QAEtBzB,QAAW6D,EAAKI,OAChB1B,EAAK2B,YAAclE,EAAGmD,EAAE,EAI1B3C,EAAcC,QAAU,KACtBT,EAAGmE,QAAQlE,GACRY,MAAM,KACLM,QAAQC,IAAI,sBACd","sources":["src/publisher/pub.js"],"sourcesContent":["import { nowInSec, SkyWayAuthToken, SkyWayContext, SkyWayRoom, SkyWayStreamFactory, StreamFactory, uuidV4 } from '@skyway-sdk/room';\r\n\r\nlet me, video;\r\nconst localVideo = document.getElementById('local-video');\r\nconst cameraList = document.getElementById('camera-list');\r\nconst listButton = document.getElementById('list-button');\r\nconst joinButton = document.getElementById('join-button');\r\nconst publishButton = document.getElementById('publish-button');\r\n\r\n// get auth token\r\n// ! this function need to hide\r\nfunction getToken () {\r\n  const token = new SkyWayAuthToken({\r\n    jti: uuidV4(),\r\n    iat: nowInSec(),\r\n    exp: nowInSec() + 60 * 60 * 24,\r\n    scope: {\r\n      app: {\r\n        id: '1194851a-7721-4348-951a-f502fd4dccb3',\r\n        turn: true,\r\n        actions: ['read'],\r\n        channels: [\r\n          {\r\n            id: '*',\r\n            name: '*',\r\n            actions: ['write'],\r\n            members: [\r\n              {\r\n                id: '*',\r\n                name: '*',\r\n                actions: ['write'],\r\n                publication: {\r\n                  actions: ['write'],\r\n                },\r\n                subscription: {\r\n                  actions: ['write'],\r\n                },\r\n              },\r\n            ],\r\n            sfuBots: [\r\n              {\r\n                actions: ['write'],\r\n                forwardings: [\r\n                  {\r\n                    actions: ['write'],\r\n                  },\r\n                ],\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      },\r\n    },\r\n  }).encode('zufyzTSf6JdsD1m4feyiG8id/aju8Hyh7ROgcyHeHKY=');\r\n\r\n  return token;\r\n}\r\n\r\n// list video-devices\r\nlistButton.onclick = () => {\r\n  navigator.mediaDevices.enumerateDevices()\r\n    .then(devices => {\r\n      const videoDevices = devices.filter(device => device.kind === 'videoinput');\r\n      videoDevices.forEach(device => {\r\n        console.log(device.kind + \": \" + device.label + \" id = \" + device.deviceId);\r\n        const option = document.createElement(\"option\");\r\n        option.value = device.deviceId;\r\n        option.text = device.label;\r\n        cameraList.appendChild(option);\r\n      });\r\n    })\r\n    .catch(err => {\r\n      console.log(err.name + \": \" + err.message);\r\n    })\r\n}\r\n\r\n// previw video\r\n// automatically preview video when change selection\r\ncameraList.onchange = async () => {\r\n  console.log(cameraList.value);\r\n  video = await SkyWayStreamFactory.createCameraVideoStream(\r\n    { deviceId: cameraList.value }\r\n  );\r\n  video.attach(localVideo);\r\n  await localVideo.play();\r\n}\r\n\r\n// join room\r\njoinButton.onclick = async () => {\r\n  const roomNameInput = document.getElementById('room-name');\r\n  const myId = document.getElementById('my-id');\r\n  if (roomNameInput.value === '') return;\r\n\r\n  const context = await SkyWayContext.Create(getToken());\r\n  const room = await SkyWayRoom.FindOrCreate(context, {\r\n    type: 'p2p',\r\n    name: roomNameInput.value,\r\n  });\r\n  me = await room.join();\r\n  myId.textContent = me.id;\r\n}\r\n\r\n// publish video\r\npublishButton.onclick = () => {\r\n  me.publish(video)\r\n    .then( () => {\r\n      console.log(\"publish success!\");\r\n    })\r\n}"],"names":["$hlpVk","parcelRequire","$e740f96962be2e0e$var$me","$e740f96962be2e0e$var$video","$e740f96962be2e0e$var$localVideo","document","getElementById","$e740f96962be2e0e$var$cameraList","$e740f96962be2e0e$var$listButton","$e740f96962be2e0e$var$joinButton","$e740f96962be2e0e$var$publishButton","onclick","navigator","mediaDevices","enumerateDevices","then","devices","filter","device","kind","forEach","console","log","label","deviceId","option","createElement","value","text","appendChild","catch","err","name","message","onchange","async","SkyWayStreamFactory","createCameraVideoStream","attach","play","roomNameInput","myId","context","SkyWayContext","Create","SkyWayAuthToken","jti","uuidV4","iat","nowInSec","exp","scope","app","id","turn","actions","channels","members","publication","subscription","sfuBots","forwardings","encode","room","SkyWayRoom","FindOrCreate","type","join","textContent","publish"],"version":3,"file":"pub.0b97b293.js.map"}